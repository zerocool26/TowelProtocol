<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PrivacyHardeningUI.ViewModels"
             xmlns:views="using:PrivacyHardeningUI.Views"
             x:Class="PrivacyHardeningUI.Views.ApplyView"
             x:DataType="vm:ApplyViewModel">

  <Grid ColumnDefinitions="*,420" Margin="12">

    <Border Grid.Column="0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
      <views:PolicySelectionView DataContext="{Binding Selection}" />
    </Border>

    <Border Grid.Column="1" Margin="12,0,0,0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12">
      <StackPanel Spacing="10">
        <TextBlock Classes="title" Text="Apply" />
        <TextBlock Opacity="0.75" TextWrapping="Wrap" Text="Stage 1 selection, Stage 2 preview, Stage 3 apply, Stage 4 verify." />

        <Border Background="{DynamicResource PanelBrush}" CornerRadius="6" Padding="10">
          <StackPanel Spacing="6">
            <TextBlock FontWeight="SemiBold" Text="Selection summary" />
            <TextBlock Text="{Binding SelectedCount}" />
            <TextBlock Opacity="0.75" Text="Selected policies" />
            <Border Background="{DynamicResource WarningBrush}" CornerRadius="6" Padding="8,2" IsVisible="{Binding HasHighRiskSelected}">
              <TextBlock Foreground="White" FontSize="12" FontWeight="SemiBold" Text="High risk selected â€” preview required" />
            </Border>
          </StackPanel>
        </Border>

        <Button Content="Refresh summary" Command="{Binding RefreshSummaryCommand}" />

        <Separator/>

        <TextBlock Text="Options" FontWeight="SemiBold"/>
        <CheckBox Content="Create System Restore Point" IsChecked="{Binding CreateRestorePoint}" 
                  ToolTip.Tip="Highly Recommended: Creates a restore point before applying changes so you can undo if anything breaks."/>

        <Button Classes="accent" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" 
                Content="APPLY CHANGES" FontWeight="Bold" Padding="12"
                Command="{Binding ApplyCommand}" IsEnabled="{Binding !IsApplying}"/>

        <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsApplying}" />
        
        <TextBlock Text="{Binding LastOperationResult}" TextWrapping="Wrap" Classes="Caption" />

      </StackPanel>
    </Border>

  </Grid>
</UserControl>
